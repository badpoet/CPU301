CPU301 Dev Document
======

Too young. Too simple. Sometimes naive.

## 项目组织

直接使用xilinx ise组织即可。

## 代码风格（ZXK）

这是我现在采用的代码风格。各位可以采用各种不同的风格，但在同一个文件内尽量保持一致。反正VHDL不区分大小写……

### 命名习惯

+ 文件名全小写、无下划线（不重要）
+ 实体名、层次名全大写，用下划线分隔单词
+ 信号、变量、例化元件等，第一个单词的首字母大写其余小写，下划线分隔单词。RAM、CPU等常见多词缩写永远大写
+ 例化元件通常用实体名+`_c`来表示

### 层次习惯

+ 功能实现全部是`RTL`
+ 顶层是`STRUCTRAL`
+ 测试（以及可能会有的中间件）是`BEHAVIORAL`

### 奇技淫巧

1. 首先使用`RTL_viewer`做元件示意图，根据电路结构检查代码的行为是否合意（如果出现顶层元件不对，可以clear project再来。另外，Design Summary文件中的蓝色warning比较重要，一般需要改）；
2. 使用仿真进行单元测试；
3. 配合官方FlashAndRam程序进行测试（配置方法后附）

## 各种说明

### FlashAndRam配置与使用

网络学堂可下载。PPT里极其语焉不详。我把我现在用到的功能写一下，各位之后最好也不断补充备忘。

#### 配置

要将impact（Xilinx的某个工具）加到环境变量里。impact大概的位置是`%xilinx%\ISE_DS\ISE\bin\nt_64`，先检查一下，大概就是这样如果不对就搜一下。

#### 写内存

1. 开程序，选择正确的串口（可以挨个试）
2. 左下角“下载主控程序”。如果impact配置对了，会有一个黑框弹出来刷好多信息。
3. 先在右上角选Ram2，再在左边选“以二进制载入任意文件”，载入到Ram2中（这里的Ram2指的是该程序的某个变量）。右下角运行信息里应该有“成功读入xx字”。
4. 右侧“写入Ram2”，应该有“成功写入xx字”。
5. 左下角选择用户程序-下载用户程序，把自己项目的.bit文件扔进去即可。

## 程序现状

我把IF阶段（不包括译码和IF/ID寄存器）都写了，接下来打算写ID。现在CPU_TOP是一个IF阶段的验证程序，PC不断加4，读出Ram2中相应位置的数据。

LED的左四位是4个时钟信号的测试：Clk（主频），Clk_x2（二倍主频），Clk_x4（四倍主频），Clk_base（基频）。现在的代码中，Clk_x4 = Clk_base，其他两个频率由base分频得到。当前的base是2Hz，是50MHz分频出来的（方便调试观察）。
边沿上，保证主频在上升沿时，二倍频、四倍频都是上升沿；二倍频上升沿时，四倍频是上升沿。

在binfiles文件夹中，有个manyzeros.bdata的文件，用上面所说写内存的方法可以把它写到Ram2上测试，其内容为264个全0字。将它烧到内存上，再将bit文件下载到板子上，就可以观察IF的工作了。
